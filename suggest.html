
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title></title>

    <link href="http://tools.liwit.com/assets/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://tools.liwit.com/assets/js/bootstrap.min.js"></script>
  </head>

  <body>

	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12">
				<h1 id="type" class="page-header">Google Suggest</h1>

				<div class="container-fluid">

					<table border="0">
						<tr>
							<td valign="top">

								<div class="panel panel-default" style="width: 400px;">
								  <div class="panel-body">
								    <!--<p>Introduce 1 término</p>
								    <input id="termino_principal" type="text" class="form-control" style="width: 250px;" value="whatsapp" placeholder="Nombre app, programa, juego">
								    <br>-->
								    <p>Añade el término a las palabras de ayuda test A + B + C...</p>
								    <input id="input" type="text" class="form-control" style="width: 250px;" value="whatsapp" placeholder="">

								    <hr>
								    <input id="startjob" onclick="StartJob();" type="button" value="Suggest keywords" class="btn btn-default">
								  </div>
								</div>

							</td>
							<td style="padding-left: 9px;">
								
								<div class="panel panel-default" style="width: 450px;">
								  <div class="panel-body">
								    
								    <p>Tendencia de búsqueda</p>
								    <iframe id="google_trends" src="" width="400" height="220" frameborder="0" scrolling="no"></iframe>

								  </div>
								</div>
							</td>
						</tr>
					</table>

				  	<div id="numofkeywords"></div>
		            
		            
		            <div id="container"></div>
		            <textarea id="queryoutput" style="display:none;"></textarea><br>

		            <div class="container-fluid">
						<div class="row">
							<div class="col-xs-6 col-md-4">
								<div id="longtail_group_1" style="height: 300px; overflow: scroll;"></div>
							</div>

							<div class="col-xs-6 col-md-4">
								<div id="longtail_group_2" style="height: 300px; overflow: scroll;"></div>
							</div>

							<div class="col-xs-6 col-md-4">
								<div id="longtail_group_3" style="height: 300px; overflow: scroll;"></div>
							</div>

		            	</div>
		            </div>

				    <script type="text/javascript">
				        var hashMapResults = {}; 
				        var numOfKeywords = 0; 
				        var doWork = false; 
				        var keywordsToQuery = new Array();
				        var keywordsToQueryIndex = 0; 
				        var queryflag = false; 
				        
				        window.setInterval(DoJob, 750); 
				        
				        function StartJob()
				        {
				            if(doWork == false)
				            {
				            	$("#longtail_group_1").empty();
				        		$("#longtail_group_2").empty();
				        		$("#longtail_group_3").empty();

				                hashMapResults = {}; 
				                numOfKeywords = 0; 
				                keywordsToQuery = new Array();
				                keywordsToQueryIndex = 0; 
				                
				                hashMapResults[""] = 1; 
				                hashMapResults[" "] = 1; 
				                hashMapResults["  "] = 1; 
				                
				                //	añadimos el como
				                //var termino_principal = $('#termino_principal').val();

				                var ks = $('#input').val().split("\n");
				                var i = 0; 
				                for(i = 0; i < ks.length; i++)
				                {
				                	//console.log(ks[i]);
				                    keywordsToQuery[keywordsToQuery.length] = ks[i];

				                    var j = 0; 
				                    for(j = 0; j < 26; j++)
				                    {
				                        var chr = String.fromCharCode(97 + j);
				                        var currentx = ks[i] + ' ' + chr; 
				                        keywordsToQuery[keywordsToQuery.length] = currentx; 
				                        hashMapResults[currentx] = 1;
				                    }
				                }
				                //document.getElementById("input").value = ''; 
				                document.getElementById("input").value += "\r\n";
				                
				                doWork = true; 
				                $('#startjob').val('Stop Job');
				            }
				            else
				            {
				                doWork = false; 
				                $('#startjob').val('Start Job');
				            }
				        }
				        
				        function DoJob()
				        {
				            if(doWork == true && queryflag == false)
				            {
				                if(keywordsToQueryIndex < keywordsToQuery.length)
				                {
				                    var currentKw = keywordsToQuery[keywordsToQueryIndex]; 
				                    QueryKeyword(currentKw);
				                    keywordsToQueryIndex++; 
				                }
				                else 
				                {
				                    if (numOfKeywords != 0)
				                    {
				                        doWork = false; 
				                        $('#startjob').val('Start Job');
				                    }
				                    else
				                    {
				                        keywordsToQueryIndex = 0; 
				                    }
				                }
				            }
				        }
				        
				        function QueryKeyword(keyword)
				        {
				            var querykeyword = keyword;
				            //var querykeyword = encodeURIComponent(keyword); 
				            var queryresult = ''; 
				            queryflag = true; 
				            
				            $.ajax({
				                url: "http://suggestqueries.google.com/complete/search",
				                jsonp: "jsonp",
				                dataType: "jsonp",
				                data: {
				                q: querykeyword,
				                client: "chrome"
				                },
				                success: function(res) {
				                    var retList = res[1];
				                    
				                    var i = 0; 
				                    var sb = ''; 
				                    for(i = 0; i < retList.length; i++)
				                    {
				                        var currents = CleanVal(retList[i]); 
				                        if(hashMapResults[currents] != 1)
				                        {
				                            hashMapResults[currents] = 1; 
				                            sb = sb + CleanVal(retList[i]) + '\r\n';

				                            //	EMILIANO
				                            var new_key = CleanVal(retList[i]);
				                            var item = '<p><button type="button" onclick="showModal(\''+new_key+'\');" class="btn btn-default btn-xs">'+new_key+'</button></p>';
				                    		
				                    		if(new_key.length < 15)
				                    		{
				                    			$("#longtail_group_1").append(item);
				                    		}
				                    		else if(new_key.length > 15 && new_key.length < 30)
				                    		{
				                    			$("#longtail_group_2").append(item);
				                    		}
				                    		else if(new_key.length > 30)
				                    		{
				                    			$("#longtail_group_3").append(item);
				                    		}

				                            numOfKeywords++; 
				                            
				                            keywordsToQuery[keywordsToQuery.length] = currents; 

				                            var j = 0; 
				                            for(j = 0; j < 26; j++)
				                            {
				                                var chr = String.fromCharCode(97 + j);
				                                var currentx = currents + ' ' + chr; 
				                                keywordsToQuery[keywordsToQuery.length] = currentx; 
				                                hashMapResults[currentx] = 1;
				                            }
				                        }
				                    }
				                    $("#numofkeywords").html(numOfKeywords); 

				                    //document.getElementById("input").value += sb;

				                    


				                    var textarea = document.getElementById("input");
				                    textarea.scrollTop = textarea.scrollHeight;
				                    queryflag = false; 
				                }
				            });           
				        }
				        
				        function CleanVal(input)
				        {       
				            var val = input;
				            val = val.replace("\\u003cb\\u003e", "");
				            val = val.replace("\\u003c\\/b\\u003e", "");
				            val = val.replace("\\u003c\\/b\\u003e", "");
				            val = val.replace("\\u003cb\\u003e", "");
				            val = val.replace("\\u003c\\/b\\u003e", "");
				            val = val.replace("\\u003cb\\u003e", "");
				            val = val.replace("\\u003cb\\u003e", "");
				            val = val.replace("\\u003c\\/b\\u003e", "");
				            val = val.replace("\\u0026amp;", "&");
				            val = val.replace("\\u003cb\\u003e", "");
				            val = val.replace("\\u0026", "");
				            val = val.replace("\\u0026#39;", "'");
				            val = val.replace("#39;", "'");
				            val = val.replace("\\u003c\\/b\\u003e", "");
				            val = val.replace("\\u2013", "2013");
				            if (val.length > 4 && val.substring(0, 4) == "http") val = "";
				            return val; 
				        }

				        function showModal(keyword)
				        {
				        	$("#google_trends").attr("src", 'http://tools.liwit.com/embed/google-trends/'+keyword);
				        }
				        
				    </script>
				  	
				</div>
				
			</div>
		</div>
	</div>

  </body>
</html>
